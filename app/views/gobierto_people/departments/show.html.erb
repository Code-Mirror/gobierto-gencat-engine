<% content_for :breadcrumb do %>
  <li><%= link_to t("gobierto_people.departments.index.title"), gobierto_people_departments_path(date_range_params) %></li>
  <li><%= title @department.name %></li>
<% end %>

<% content_for :disable_turbolinks_hook do %>
  <meta name="turbolinks-visit-control" content="reload">
<% end %>

<section class="row">
  <div class="col-md-offset-9 col-md-3">
    <%= render "gobierto_people/shared/datepicker" %>
  </div>
</section>

<section class="row">
  <div class="fpca_distribuidora">
    <div class="llistat_destacat_text_avancat">
      <div class="llistat_col-lg-3 nova-altura-dist same-height-wrapper">

        <div class="corrector-margins col-xs-12 col-md-4">
          <div class="box color-1 distribuidora-nova-3">
            <div class="color-decorator">
              <h1><%= @department_stats[:total_meetings] %></h1>
              <h5>
                <p><strong><%= t(".meetings_box_title") %></strong></p>
              </h5>
            </div>
          </div>
        </div>

        <div class="corrector-margins col-xs-12 col-md-4">
          <div class="box color-2 distribuidora-nova-3">
            <div class="color-decorator">
              <h1><%= @department_stats[:unique_interest_groups] %></h1>
              <h5>
                <p><strong><%= t(".interest_groups_box_title") %></strong></p>
                <p><%= t(".interest_groups_box_subtitle") %></p>
              </h5>
            </div>
          </div>
        </div>

        <div class="corrector-margins col-xs-12 col-md-4">
          <div class="box color-3 distribuidora-nova-3">
            <div class="color-decorator">
              <%= link_to gobierto_people_department_people_path(@department, date_range_params), class: "no-link" do %>
                <h1><%= @department_stats[:total_people_with_attendances] %></h1>
              <% end %>
              <h5>
                <p><strong><%= t(".people_box_title") %></strong></p>
                <p><%= t(".people_box_subtitle") %></p>
              </h5>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<section>
  <pre>
  URL para sacar personas, mira en departmentsShowArgs.department_people_events_rowchart_api_path:
  <%= gobierto_people_api_v1_people_path(from_date: filter_start_date, to_date: filter_end_date, department_id: @department.id) %>
  </pre>
</section>

<% if trips_submodule_active? %>
  <section id="map-chart">
    <p><strong><%= t(".map_title") %></strong></p>

    <%= render "gobierto_people/shared/map" %>
  </section>
<% end %>

<section class="row">

  <div class="col-md-6" id="gifts-wrapper">
    <section>
      <p><strong><%= t(".gifts") %></strong></p>
      <p><%= t(".gifts_description") %></p>
      <div class="alert alert-warning">
        <small><%= t(".gifts_coc") %> <%= render 'gobierto_people/shared/code_of_conduct_link' %></small>
      </div>
    </section>

    <% if @department.gifts.any? %>
      <figure>
        <figcaption class="mb_20"><%= t(".last_gifts") %></figcaption>
        <ul class="color-4 transparent mb_20">
          <% @department.gifts.each do |gift| %>
            <%= render(
                  "gobierto_people/welcome/table_item",
                  title: gift.name,
                  resource: gift,
                  resource_path: gobierto_people_person_gifts_path(
                    gift.person.slug,
                    { anchor: gift.to_anchor }.merge(date_range_params)
                  ),
                  display_date: gift.date
                ) %>
          <% end %>
        </ul>
      </figure>

      <%= link_to gobierto_people_people_path do %>
        <small><%= t(".view_officials") %></small>
      <% end %>
    <% else %>
      <em><%= t(".no_gifts") %></em>
    <% end %>
  </div>

  <div class="col-md-6" id="invitations-wrapper">
    <section>
      <p><strong><%= t(".invitations") %></strong></p>
      <p><%= t(".invitations_description") %></p>
      <div class="alert alert-warning">
        <small><%= t(".invitations_coc") %> <%= render 'gobierto_people/shared/code_of_conduct_link' %></small>
      </div>
    </section>

    <% if @department.invitations.any? %>
      <figure>
        <figcaption class="mb_20"><%= t(".last_invitations") %></figcaption>
        <ul class="color-3 transparent mb_20 mb_20">
          <% @department.invitations.each do |invitation| %>
            <%= render(
                  "gobierto_people/welcome/table_item",
                  title: invitation.title,
                  resource: invitation,
                  resource_path: gobierto_people_person_invitations_path(
                    invitation.person.slug,
                    { anchor: invitation.to_anchor }.merge(date_range_params)
                  ),
                  display_date_range: [invitation.start_date, invitation.end_date]
                ) %>
          <% end %>
        </ul>
      </figure>

      <%= link_to gobierto_people_people_path do %>
        <small><%= t(".view_officials") %></small>
      <% end %>
    <% else %>
      <em><%= t(".no_invitations") %></em>
    <% end %>
  </div>

</section>

<%= render "gobierto_people/shared/open_data_footer" %>

<%= javascript_tag do %>
  mapControllerIndexParams = {
    fromDate: '<%= filter_start_date.try(:iso8601) %>',
    toDate: '<%= filter_end_date.try(:iso8601) %>',
    departmentId: '<%= @department.id %>'
  }

  departmentsShowArgs = {
    department_people_events_rowchart_api_path: '<%= gobierto_people_api_v1_people_path(from_date: filter_start_date, to_date: filter_end_date, department_id: @department.id) %>',
    department_interest_groups_rowchart_api_path: '<%= gobierto_people_api_v1_interest_groups_path(from_date: filter_start_date, to_date: filter_end_date, department_id: @department.id) %>',
    department_people_events_punchcard_api_path: '<%= gobierto_people_api_v1_people_path(from_date: filter_start_date, to_date: filter_end_date, include_history: true, department_id: @department.id) %>'
  }
<% end %>
